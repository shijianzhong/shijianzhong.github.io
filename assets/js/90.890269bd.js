(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{230:function(s,a,n){"use strict";n.r(a);var e=n(2),t=Object(e.a)({},function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("原创： 锋少")]),s._v(" "),n("h2",{attrs:{id:"一、前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、前言","aria-hidden":"true"}},[s._v("#")]),s._v(" 一、前言")]),s._v(" "),n("p",[s._v("从一个较早的小程序开发者到第一批使用小程序·云开发的开发者，这期间一直在关注关于小程序各方面的更新，同时也用小程序·云开发做了几款产品，其中包括上次分享的"),n("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzg3NTA1NjcyNQ==&mid=2247483701&idx=1&sn=0176e67b7647f6632fe0ce1721beb961&chksm=cec61a0ff9b1931963c221a5fdb3c58ef7a22cf0fc4c58e120672943c9c5d29f63ec65b7189d&token=1242218487&lang=zh_CN&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[s._v("随手记 Lite 小程序"),n("OutboundLink")],1),s._v("，比较上次，这次分享的技术点相对更加全面和实用一些。")]),s._v(" "),n("blockquote",[n("p",[s._v("涉及的技术点有：")])]),s._v(" "),n("ul",[n("li",[s._v("数据上传、数据更新、分页读取、数据删除，AI 智能名片识别读取。")]),s._v(" "),n("li",[s._v("单图上传、多图上传，图片 URL 获取，带参小成码生成。")]),s._v(" "),n("li",[s._v("下发模板消息，云调用使用。")])]),s._v(" "),n("h2",{attrs:{id:"二、主要功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、主要功能","aria-hidden":"true"}},[s._v("#")]),s._v(" 二、主要功能")]),s._v(" "),n("ul",[n("li",[s._v("创建电子名片："),n("strong",[s._v("信息存储，图片上传，名片读取（AI 智能名片识别）")])]),s._v(" "),n("li",[s._v("转发电子名片："),n("strong",[s._v("专属名片海报（带参小程序码生成）")])]),s._v(" "),n("li",[s._v("电子名片被访问："),n("strong",[s._v("下发模板消息（云调用）")])])]),s._v(" "),n("h2",{attrs:{id:"三、功能实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、功能实现","aria-hidden":"true"}},[s._v("#")]),s._v(" 三、功能实现")]),s._v(" "),n("h3",{attrs:{id:"_3-1-准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-准备工作","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.1 准备工作")]),s._v(" "),n("p",[s._v("1、注册微信小程序账号：")]),s._v(" "),n("blockquote",[n("p",[s._v("方式一：直接注册（"),n("a",{attrs:{href:"https://mp.weixin.qq.com/wxopen/waregister?action=step1",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mp.weixin.qq.com/wxopen/waregister?action=step1"),n("OutboundLink")],1),s._v("）\n方式二：已经有微信公众号（已认证）朋友可以直接【登录公众号】 -> 【小程序管理】 -> 【添加】->【快速注册并认证小程序】，注册完成后，找到小程序的 AppID 和 AppSecret")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://ask.qcloudimg.com/http-save/4744530/7ju2s9l158.webp",alt:""}})]),s._v(" "),n("p",[s._v("2、下载微信开发者工具、创建项目 ，打开开发者工具，键入项目目录、项目名称、刚才的 AppID，此时项目创建成功，然后点击开发者工具上方的【云开发】开通云开发。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-功能实现一：【创建电子名片】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-功能实现一：【创建电子名片】","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.2 功能实现一：【创建电子名片】")]),s._v(" "),n("h4",{attrs:{id:"信息存储，图片上传，名片读取（ai-智能名片识别）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#信息存储，图片上传，名片读取（ai-智能名片识别）","aria-hidden":"true"}},[s._v("#")]),s._v(" 信息存储，图片上传，名片读取（AI 智能名片识别）")]),s._v(" "),n("h4",{attrs:{id:"_1-功能简要描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-功能简要描述","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.功能简要描述")]),s._v(" "),n("p",[s._v("对于一个名片的小程序，第一步肯定是创建电子名片，除此之外，可以用传统信息录入的方式创建名片，同时也支持纸质名片的识别读取，快速创建名片，这里本地需要导入 "),n("code",[s._v("mapping.js")]),s._v("框架，接下来以纸质名片识别为例。")]),s._v(" "),n("h4",{attrs:{id:"_2-核心代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-核心代码","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.核心代码")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("  // 上传名片后获取零时链接\n  getTempFileURL() {\n    wx.cloud.getTempFileURL({\n      fileList: [{\n        fileID: this.data.fileID,\n      }],\n    }).then(res => {\n      console.log('获取成功', res);\n      if (res.fileList.length) {\n        this.setData({\n          coverImage: res.fileList[0].tempFileURL\n        }, () => {\n          this.parseNameCard();\n        });\n      } else {\n        Toast('获取图片地址失败');\n      }\n    }).catch(err => {\n      Toast('获取图片地址失败');\n    });\n  },\n  // 读取名片\n  parseNameCard() {\n    wx.cloud.callFunction({\n      name: 'parseCard',\n      data: {\n        url: this.data.coverImage\n      }\n    }).then(res => {\n      if (res.result.data.length == 0) {\n        Toast('解析失败，请上传【纸质名片】或【手动创建】');\n        return;\n      }\n      let data = this.transformMapping(res.result.data);\n      wx.setStorageSync(\"parseCardData\", data)\n      Toast('解析成功');\n    }).catch(err => {\n      console.error('解析失败，请上传【纸质名片】或【手动创建】', err);\n      Toast('解析失败，请上传【纸质名片】或【手动创建】');\n    });\n  },\n\n  // 名片数据解析\n  transformMapping(data) {\n    let record = {};\n    let returnData = [];\n    data.map((item) => {\n      let name = null;\n      if (mapping.hasOwnProperty(item.item)) {\n        name = mapping[item.item];\n        // 写入英文名\n        item.name = name;\n      }\n      return item;\n    });\n    // 过滤重复的字段\n    data.forEach((item) => {\n      if (!record.hasOwnProperty(item.item)) {\n        returnData.push(item);\n        record[item.item] = true;\n      }\n    });\n    return returnData;\n  },\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br")])]),n("h3",{attrs:{id:"_3-3-功能实现二：【转发电子名片】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-功能实现二：【转发电子名片】","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.3 功能实现二：【转发电子名片】")]),s._v(" "),n("h4",{attrs:{id:"专属名片海报（带参小程序码生成）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#专属名片海报（带参小程序码生成）","aria-hidden":"true"}},[s._v("#")]),s._v(" 专属名片海报（带参小程序码生成）")]),s._v(" "),n("h4",{attrs:{id:"_1-功能简要描述：转发电子名片有两种方式。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-功能简要描述：转发电子名片有两种方式。","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.功能简要描述：转发电子名片有两种方式。")]),s._v(" "),n("blockquote",[n("p",[s._v("1.以小程序的形式直接转发给好友或微信群。 2.生成专属名片海报分享到朋友圈长按进入对应的电子名片页面。名片海报上除了有对应用户的姓名之外，还有专属的名片小程序码，效果如下：")])]),s._v(" "),n("p",[n("img",{attrs:{src:"https://ask.qcloudimg.com/http-save/4744530/1tcjbf9m3q.webp",alt:""}})]),s._v(" "),n("h4",{attrs:{id:"_2-核心代码-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-核心代码-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.核心代码")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const cloud = require('wx-server-sdk')\nconst axios = require('axios')\nvar rp = require('request-promise');\ncloud.init()\n\n// 云函数入口函数，小程序端传过来页面和名片id\nexports.main = async (event, context) => {\n  console.log(event)\n  try {\n    const resultValue = await rp('https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=appid&secret=secret')\n    const token = JSON.parse(resultValue).access_token;\n    const response = await axios({\n      method: 'post',\n      url: 'https://api.weixin.qq.com/wxa/getwxacodeunlimit',\n      responseType: 'stream',\n      params: {\n        access_token: token,\n      },\n      data: {\n        page: event.page,\n        width: 300,\n        scene: event.id,\n      },\n    });\n\n    return await cloud.uploadFile({\n      cloudPath: 'xcxcodeimages/' + Date.now() + '.png',\n      fileContent: response.data,\n    });\n  } catch (err) {\n    console.log('>>>>>> ERROR:', err)\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("h3",{attrs:{id:"_3-4-功能实现三：【电子名片被访问】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-功能实现三：【电子名片被访问】","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.4 功能实现三：【电子名片被访问】")]),s._v(" "),n("h4",{attrs:{id:"下发模板消息（云调用）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下发模板消息（云调用）","aria-hidden":"true"}},[s._v("#")]),s._v(" 下发模板消息（云调用）")]),s._v(" "),n("h4",{attrs:{id:"_1-功能简要描述-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-功能简要描述-2","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.功能简要描述")]),s._v(" "),n("p",[s._v("用户名片被访问的时候，用户者会收到【客户来访提醒】的模板消息，同时提醒用户完善名片信息。")]),s._v(" "),n("h4",{attrs:{id:"_2-核心代码-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-核心代码-3","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.核心代码")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const cloud = require('wx-server-sdk')\ncloud.init()\nexports.main = async (event, context) => {\n  try {\n    const result = await cloud.openapi.templateMessage.send({\n      touser: event.toUser,\n      page: \"pages/index/index\",\n      data: {\n        keyword1: {\n          value: event.visitDate\n        },\n        keyword2: {\n          value: \"刚刚有人深度访问了您的名片，经常完善名片信息，更容易被查找和访问。\"\n        },\n      },\n      templateId: 'templateId',\n      formId: event.formId,\n    })\n    return result\n  } catch (err) {\n    throw err\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h2",{attrs:{id:"四、总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 四、总结")]),s._v(" "),n("blockquote",[n("p",[s._v("和传统的小程序 + WEB 后台开发模式比起来，云开发在精力和人力上真的是节省了很多，这能使开发者将大部分精力和时间放到功能的开发上。\n云开发上线时间不算太长，但逐步有新的功能开放出来，比如云控制台数据的导入导出、云调用等，希望小程序·云开发开放出更多的接口和功能......")])]),s._v(" "),n("h2",{attrs:{id:"五、项目预览"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、项目预览","aria-hidden":"true"}},[s._v("#")]),s._v(" 五、项目预览")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://ask.qcloudimg.com/http-save/4744530/7crisu2p1h.webp",alt:""}})])])},[],!1,null,null,null);a.default=t.exports}}]);