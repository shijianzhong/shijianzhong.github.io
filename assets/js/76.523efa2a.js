(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{217:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"操作场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作场景","aria-hidden":"true"}},[s._v("#")]),s._v(" 操作场景")]),s._v(" "),a("p",[s._v("当开发者已经拥有小程序账号，并已开通了云开发服务创建了云开发环境后，接下来就是开发小程序的客户端及服务端。")]),s._v(" "),a("h2",{attrs:{id:"操作步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作步骤","aria-hidden":"true"}},[s._v("#")]),s._v(" 操作步骤")]),s._v(" "),a("h3",{attrs:{id:"客户端使用云开发能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端使用云开发能力","aria-hidden":"true"}},[s._v("#")]),s._v(" 客户端使用云开发能力")]),s._v(" "),a("p",[s._v("客户端，这里指在小程序端中。如果您需要使用云开发能力，请做以下配置：")]),s._v(" "),a("ul",[a("li",[s._v("在  app.json / game.json  中， 中增加字段  "),a("code",[s._v('"cloud": true')]),s._v("。")]),s._v(" "),a("li",[s._v("project.config.json 中增加了字段 "),a("code",[s._v("cloudfunctionRoot")]),s._v(" 用于指定存放云函数的目录。")])]),s._v(" "),a("p",[s._v("客户端代码，均是用户使用 IDE 工具完成的前端代码。")]),s._v(" "),a("h4",{attrs:{id:"初始化云开发能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化云开发能力","aria-hidden":"true"}},[s._v("#")]),s._v(" 初始化云开发能力")]),s._v(" "),a("p",[s._v("此段代码需要加入在 IDE 中的 app.js 中，如下图所示：\n"),a("img",{attrs:{src:"https://main.qcloudimg.com/raw/4cbbc4976c515945b85f8c1489dfb54e.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//app.js\nApp({\n  onLaunch: function () {\n    wx.cloud.init({\n        traceUser: true\n    });\n  }\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("详情请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/init.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("初始化能力文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("blockquote",[a("p",[s._v("?在用户管理中会显示使用云能力的小程序的访问用户列表，默认以访问时间倒叙排列，访问时间的触发点是在小程序端调用  wx.cloud.init 方法，且其中的  "),a("code",[s._v("traceUser")]),s._v("  参数传值为  true。")])]),s._v(" "),a("h4",{attrs:{id:"小程序操作存储资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序操作存储资源","aria-hidden":"true"}},[s._v("#")]),s._v(" 小程序操作存储资源")]),s._v(" "),a("p",[s._v("初始化完成后，客户端代码即可通过 SDK 对云开发的后台资源进行访问与操作。下述的是一个典型的存储资源的操作示例代码，您可以在您的前端代码中进行更多的存储类操作。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 选择图片\nwx.chooseImage({\n    success: dRes => {\n        // 上传图片\n        const uploadTask = wx.cloud.uploadFile({\n            cloudPath: `${Date.now()}-${Math.floor(Math.random(0, 1) * 10000000)}.png`, // 随机图片名\n            filePath: dRes.tempFilePaths[0], // 本地的图片路径\n            success: console.log,\n            fail: console.error\n        });\n    },\n    fail: console.error,\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("更多详情请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/storage/",target:"_blank",rel:"noopener noreferrer"}},[s._v("存储文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"小程序操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序操作数据库","aria-hidden":"true"}},[s._v("#")]),s._v(" 小程序操作数据库")]),s._v(" "),a("p",[s._v("同样的，初始化完成后，客户端代码即可通过 SDK 对云开发的提供的数据库进行资源操作。下述的是一个典型的数据库操作示例代码，您可以在您的前端代码中进行更多的数据库操作。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const db = wx.cloud.database();\n\ndb.collection('blog').get().then((res) => {\n    let data = res.data;\n    console.log(data);\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("更多详情请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/database/",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据库文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"小程序调用云函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序调用云函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 小程序调用云函数")]),s._v(" "),a("p",[s._v("当您的小程序需要计算能力/后台处理能力时，则需要在前端代码中调用云开发提供的函数能力。下述代码为典型的在客户端调用云函数的示例代码。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wx.cloud.callFunction({\n    name: 'addblog', // 云函数名称\n    data: { // 传到云函数处理的参数\n        title: '云开发 CloudBase',\n        content: '存储、数据库存、云函数'\n    }\n}).then(res => {\n    console.log(res)\n}).catch((err) => {\n    console.error(err);\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("更多详情请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-client-api/functions/",target:"_blank",rel:"noopener noreferrer"}},[s._v("云函数文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"服务端使用云开发能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端使用云开发能力","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端使用云开发能力")]),s._v(" "),a("p",[s._v("在很多应用场景中，后台也需要对存储、数据库等资源进行操作，如果您想在云函数中，操作文件、数据库和云函数资源，您可以使用我们提供的服务端 SDK 来进行开发。首先，进入到您的某个云函数中，安装以下依赖包：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm i --save tcb-admin-node\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("!服务端下述的所有代码，均需要用户部署在云函数中。这里的示例均为使用云开发的服务端 SDK。同时也可以使用 wx-server-sdk，与 tcb-admin-nod 提供同样的能力，若使用 wx-server-sdk 则请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-server-api/",target:"_blank",rel:"noopener noreferrer"}},[s._v("云开发 Server API 文档"),a("OutboundLink")],1),s._v("。")])]),s._v(" "),a("h4",{attrs:{id:"在云函数中初始化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在云函数中初始化","aria-hidden":"true"}},[s._v("#")]),s._v(" 在云函数中初始化")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 初始化示例\nconst app = require('tcb-admin-node');\n\n// 初始化资源\n// 云函数下不需要secretId和secretKey。\n// env如果不指定将使用默认环境\napp.init({\n  secretId: 'xxxxx',\n  secretKey: 'xxxx',\n  env: 'xxx'\n});\n\n//云函数下使用默认环境\napp.init()\n\n//云函数下指定环境\napp.init({\n  env: 'xxx'\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("详情请参考 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/876/19391",target:"_blank",rel:"noopener noreferrer"}},[s._v("初始化文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"服务端操作文件资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端操作文件资源","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端操作文件资源")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const app = require('tcb-admin-node');\napp.init();\n\napp.uploadFile({\n    cloudPath: \"cover.png\",\n    fileContent: fs.createReadStream(`${__dirname}/cover.png`)\n}).then((res) => {\n    console.log(res);\n}).catch((err) => {\n    console.error(err);\n});;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("详情请参考 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/876/18442",target:"_blank",rel:"noopener noreferrer"}},[s._v("存储文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"服务端操作数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端操作数据库","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端操作数据库")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const app = require('tcb-admin-node');\napp.init();\nconst db = app.database();\n\ndb.collection('blogs').limit(10).get().then((res) => {\n    console.log(res);\n}).catch((err) => {\n    console.error(err);\n});;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("详情请参考 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/876/18441",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据库文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"服务端调用云函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端调用云函数","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端调用云函数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const app = require(\"tcb-admin-node\");\napp.init();\n\napp.callFunction({\n    name: 'addblog', // 云函数名称\n    data: { // 传到云函数处理的参数\n        title: '云开发 CloudBase',\n        content: '存储、数据库存、云函数'\n    }\n}).then((res) => {\n    console.log(res);\n}).catch((err) => {\n    console.error(err);\n});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("详情请参考 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/876/18440",target:"_blank",rel:"noopener noreferrer"}},[s._v("云函数文档"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"语法糖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法糖","aria-hidden":"true"}},[s._v("#")]),s._v(" 语法糖")]),s._v(" "),a("p",[s._v("大部分的接口，目前都支持两种写法，分别是 Promise 和 Async/Await。Async/Await  本质上是基于  Promise  的一种语法糖，它只是把  Promise  转换成同步的写法而已。")]),s._v(" "),a("h4",{attrs:{id:"promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#promise","aria-hidden":"true"}},[s._v("#")]),s._v(" Promise")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const app = require(\"tcb-admin-node\");\napp.init();\n\nexports.main = async (event, context) => {\n    return new Promise((resolve, reject) => {\n    // 在 3 秒后返回结果给调用方（小程序 / 其他云函数）\n    setTimeout(() => {\n      resolve('hello world');\n    }, 3000)\n  });\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"async-await"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#async-await","aria-hidden":"true"}},[s._v("#")]),s._v(" Async/Await")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const app = require(\"tcb-admin-node\");\napp.init();\n\nexports.main = async (event, context) => {\n    let result = null;\n\n    try {\n        result = await app.callFunction({\n            name: 'addblog', // 云函数名称\n            data: { // 传到云函数处理的参数\n                title: '云开发 CloudBase',\n                content: '存储、数据库存、云函数'\n            }\n        });\n    }\n    catch (e) {\n        return e;\n    }\n\n    return result;\n};\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])])])},[],!1,null,null,null);n.default=t.exports}}]);